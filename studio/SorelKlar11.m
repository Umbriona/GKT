%beräkning av bubbelpunkten
clear all
close all
clc
Q=[ 1.0000    0.4500    0.8000    0.1000    1.5000
    2.0000    0.4500    0.8000    0.1000    1.7500
    3.0000    0.4500    0.8000    0.1000    2.0000
    4.0000    0.4500    0.9000    0.1000    2.0000
    5.0000    0.4500    0.9000    0.1000    2.5000
    6.0000    0.4500    0.9000    0.1000    3.0000
    7.0000    0.4500    0.8000    0.1500    1.5000
    8.0000    0.4500    0.8000    0.1500    1.7500
    9.0000    0.4500    0.8000    0.1500    2.0000
   10.0000    0.4500    0.9000    0.1500    2.0000
   11.0000    0.4500    0.9000    0.1500    2.5000
   12.0000    0.4500    0.9000    0.1500    3.0000
   13.0000    0.4500    0.8000    0.2000    1.5000
   14.0000    0.4500    0.8000    0.2000    1.7500
   15.0000    0.4500    0.8000    0.2000    2.0000
   16.0000    0.4500    0.9000    0.2000    2.0000
   17.0000    0.4500    0.9000    0.2000    2.5000
   18.0000    0.4500    0.9000    0.2000    3.0000
   19.0000    0.5000    0.8000    0.1000    1.5000
   20.0000    0.5000    0.8000    0.1000    1.7500
   21.0000    0.5000    0.8000    0.1000    2.0000
   22.0000    0.5000    0.9000    0.1000    2.0000
   23.0000    0.5000    0.9000    0.1000    2.5000
   24.0000    0.5000    0.9000    0.1000    3.0000
   25.0000    0.5000    0.8000    0.1500    1.5000
   26.0000    0.5000    0.8000    0.1500    1.7500
   27.0000    0.5000    0.8000    0.1500    2.0000
   28.0000    0.5000    0.9000    0.1500    2.0000
   29.0000    0.5000    0.9000    0.1500    2.5000
   30.0000    0.5000    0.9000    0.1500    3.0000
   31.0000    0.5000    0.8000    0.2000    1.5000
   32.0000    0.5000    0.8000    0.2000    1.7500
   33.0000    0.5000    0.8000    0.2000    2.0000
   34.0000    0.5000    0.9000    0.2000    2.0000
   35.0000    0.5000    0.9000    0.2000    2.5000
   36.0000    0.5000    0.9000    0.2000    3.0000
   37.0000    0.5500    0.8000    0.1000    1.2000
   38.0000    0.5500    0.8000    0.1000    1.5000
   39.0000    0.5500    0.8000    0.1000    1.8000
   40.0000    0.5500    0.9000    0.1000    1.5000
   41.0000    0.5500    0.9000    0.1000    2.0000
   42.0000    0.5500    0.9000    0.1000    2.5000
   43.0000    0.5500    0.8000    0.1500    1.2000
   44.0000    0.5500    0.8000    0.1500    1.5000
   45.0000    0.5500    0.8000    0.1500    1.8000
   46.0000    0.5500    0.9000    0.1500    1.5000
   47.0000    0.5500    0.9000    0.1500    2.0000
   48.0000    0.5500    0.9000    0.1500    2.5000
   49.0000    0.5000    0.8500    0.1000    1.5000
   50.0000    0.5000    0.8500    0.1000    1.7500
   51.0000    0.5000    0.8500    0.1000    2.0000
   52.0000    0.5000    0.8500    0.1500    2.0000
   53.0000    0.5000    0.8500    0.1500    2.5000
   54.0000    0.5000    0.8500    0.1500    3.0000
   55.0000    0.5000    0.8500    0.2000    2.0000
   56.0000    0.5000    0.8500    0.2000    2.5000
   57.0000    0.5000    0.8500    0.2000    3.0000
   58.0000    0.5500    0.8500    0.1500    1.5000
   59.0000    0.5500    0.8500    0.1500    1.8000
   60.0000    0.5500    0.8500    0.1500    2.0000];

%Givna data

xf=Q(U, 2);
F=10; % mol/h
xb=Q(U, 4);
xd=Q(U, 3);
A=[1 1;xd xb];
C=[F; F*xf];
DB=A\C;
R=Q(U, 5);
V=DB(1)*(R+1);
Lm=R*DB(1);
Ln=Lm+F;

P=760; %mmHg





Ae=18.9119;
Be=3803.98;
Ce=231.47;
Ap=17.5439;
Bp=3166.338;
Cp=193.00;





% Avdrivardel   Stegning till feedbotten:
x(1)=xb;
i=0;
f1=0;
while x<xf
    i=i+1;
        xn1=xb;
        xn2=1-xb;
        Tbubbel=77;
        avvikelse1=1;
             while abs(avvikelse1)>0.001 
                Tbubbel=Tbubbel+0.01;
                P0e=exp(Ae-Be./(Tbubbel+Ce));
                P0p=exp(Ap-Bp./(Tbubbel+Cp));
                y1=P0e.*xn1./P;
                y2=P0p.*xn2./P;
                avvikelse1=(1-y1-y2);
                f1=f1+1;
                if f1>100000
                break
                end
                alpha=(y1/xn1)/(y2/xn2);
              end
    y(i)=alpha*x(i)/(1+x(i)*(alpha-1));
    x(i+1)=V/Ln*y(i)+DB(2)/Ln*xb;
end

m=i;

while y(i)<xd
    x(i+1)=V/Lm*y(i)+1/Lm*(DB(2)*xb-F*xf);   %Komponent ballans över förstärkar delen
      xn1=xb;
        xn2=1-xb;
        Tbubbel=77;
        avvikelse1=1;
             while abs(avvikelse1)>0.001 
                Tbubbel=Tbubbel+0.01;
                P0e=exp(Ae-Be./(Tbubbel+Ce));
                P0p=exp(Ap-Bp./(Tbubbel+Cp));
                y1=P0e.*xn1./P;
                y2=P0p.*xn2./P;
                avvikelse1=(1-y1-y2);
                f1=f1+1;
                if f1>100000
                break
                end
                alpha=(y1/xn1)/(y2/xn2);
              end
    i=i+1;
    
    y(i)=alpha*x(i)/(1+x(i)*(alpha-1)); %Jv samband
end






        


disp(['bottnar nedre del    ' num2str(m)])

disp(['bottnar övre del     ' num2str(i-m)])

disp(['bottnar totalt       ' num2str(i)])




