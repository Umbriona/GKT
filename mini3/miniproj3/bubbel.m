%beräkning av bubbelpunkten
clear all
close all
clc
Q=[ 1.0000    0.4500    0.8000    0.1000    1.5000
    2.0000    0.4500    0.8000    0.1000    1.7500
    3.0000    0.4500    0.8000    0.1000    2.0000
    4.0000    0.4500    0.9000    0.1000    2.0000
    5.0000    0.4500    0.9000    0.1000    2.5000
    6.0000    0.4500    0.9000    0.1000    3.0000
    7.0000    0.4500    0.8000    0.1500    1.5000
    8.0000    0.4500    0.8000    0.1500    1.7500
    9.0000    0.4500    0.8000    0.1500    2.0000
   10.0000    0.4500    0.9000    0.1500    2.0000
   11.0000    0.4500    0.9000    0.1500    2.5000
   12.0000    0.4500    0.9000    0.1500    3.0000
   13.0000    0.4500    0.8000    0.2000    1.5000
   14.0000    0.4500    0.8000    0.2000    1.7500
   15.0000    0.4500    0.8000    0.2000    2.0000
   16.0000    0.4500    0.9000    0.2000    2.0000
   17.0000    0.4500    0.9000    0.2000    2.5000
   18.0000    0.4500    0.9000    0.2000    3.0000
   19.0000    0.5000    0.8000    0.1000    1.5000
   20.0000    0.5000    0.8000    0.1000    1.7500
   21.0000    0.5000    0.8000    0.1000    2.0000
   22.0000    0.5000    0.9000    0.1000    2.0000
   23.0000    0.5000    0.9000    0.1000    2.5000
   24.0000    0.5000    0.9000    0.1000    3.0000
   25.0000    0.5000    0.8000    0.1500    1.5000
   26.0000    0.5000    0.8000    0.1500    1.7500
   27.0000    0.5000    0.8000    0.1500    2.0000
   28.0000    0.5000    0.9000    0.1500    2.0000
   29.0000    0.5000    0.9000    0.1500    2.5000
   30.0000    0.5000    0.9000    0.1500    3.0000
   31.0000    0.5000    0.8000    0.2000    1.5000
   32.0000    0.5000    0.8000    0.2000    1.7500
   33.0000    0.5000    0.8000    0.2000    2.0000
   34.0000    0.5000    0.9000    0.2000    2.0000
   35.0000    0.5000    0.9000    0.2000    2.5000
   36.0000    0.5000    0.9000    0.2000    3.0000
   37.0000    0.5500    0.8000    0.1000    1.2000
   38.0000    0.5500    0.8000    0.1000    1.5000
   39.0000    0.5500    0.8000    0.1000    1.8000
   40.0000    0.5500    0.9000    0.1000    1.5000
   41.0000    0.5500    0.9000    0.1000    2.0000
   42.0000    0.5500    0.9000    0.1000    2.5000
   43.0000    0.5500    0.8000    0.1500    1.2000
   44.0000    0.5500    0.8000    0.1500    1.5000
   45.0000    0.5500    0.8000    0.1500    1.8000
   46.0000    0.5500    0.9000    0.1500    1.5000
   47.0000    0.5500    0.9000    0.1500    2.0000
   48.0000    0.5500    0.9000    0.1500    2.5000
   49.0000    0.5000    0.8500    0.1000    1.5000
   50.0000    0.5000    0.8500    0.1000    1.7500
   51.0000    0.5000    0.8500    0.1000    2.0000
   52.0000    0.5000    0.8500    0.1500    2.0000
   53.0000    0.5000    0.8500    0.1500    2.5000
   54.0000    0.5000    0.8500    0.1500    3.0000
   55.0000    0.5000    0.8500    0.2000    2.0000
   56.0000    0.5000    0.8500    0.2000    2.5000
   57.0000    0.5000    0.8500    0.2000    3.0000
   58.0000    0.5500    0.8500    0.1500    1.5000
   59.0000    0.5500    0.8500    0.1500    1.8000
   60.0000    0.5500    0.8500    0.1500    2.0000];

%Givna data

xf=Q(1, 2);
F=10; % mol/h
xb=Q(1, 4);
xd=Q(1, 3);
A=[1 1;xd xb];
C=[F; F*xf];
DB=A\C;
R=Q(1, 5);
V=DB(1)*(R+1);
Lm=R*DB(1);
Ln=Lm+F;

P=760; %mmHg





Ae=18.9119;
Be=3803.98;
Ce=231.47;
Ap=17.5439;
Bp=3166.338;
Cp=193.00;

f1=0;
f2=0;

%Beräkning av bubbelpunkt - whileloop
xn1=xb;
xn2=1-xb;
while xn1<xd
   Tbubbel=77;
    avvikelse1=1;
    
     while abs(avvikelse1)>0.001 
        Tbubbel=Tbubbel+0.01;
        P0e=exp(Ae-Be./(Tbubbel+Ce));
        P0p=exp(Ap-Bp./(Tbubbel+Cp));
        y1=P0e.*xn1./P;
        y2=P0p.*xn2./P;
        avvikelse1=(1-y1-y2);
        f1=f1+1;
        if f1>100000
            break
        end
        
     end
     
     if xn1<xf
     xn1=V/Ln*y1+DB(2)/Ln*xb;
     xn2=1-xn1;
     else
     xn1=V/Lm*y1+1/Lm*(DB(1)*xd-F*xf);
     xn2=1-xn1;
     end
     
     
         
     
             f2=f2+1;
        if f2>100
            break
        end
end




%Plottning
disp(xn1)
disp(y1)
disp(f2)


%Beräkning av bubbelpunkt - fsolve
%for i=1:length(x1)
 %  gamma1=exp(-log(x1(i)+w12.*x2(i))+x2(i).*(w12./(x1(i)+w12.*x2(i))-w21./(w21.*x1(i)+x2(i))));
  % gamma2=exp(-log(x2(i)+w21.*x1(i))-x1(i).*(w12./(x1(i)+w12.*x2(i))-w21./(w21.*x1(i)+x2(i))));
   %options=optimset('Display', 'Off');
%   T=fsolve(@bubbelfun,55,options,x1(i),Aa,Ba,Ca,Am,Bm,Cm,gamma1,gamma2,P);
 %  Tbubbel(i)=T;
 %  y1(i)=(10.^(Aa-Ba./(T+Ca)))*x1(i)*gamma1/P;
%end

%Plottning
%figure(3)
%plot(x1,x1); %diagonal
%hold on
%plot(x1,y1);
%ylim([0 1]);
%title('Jämviktskurva')
%figure(4)
%plot(x1,Tbubbel)
%hold on
%plot(y1,Tbubbel,'r')
%xlim([0 1]);
%title('Blå - bubbelpunkt / Röd - daggpunkt')

